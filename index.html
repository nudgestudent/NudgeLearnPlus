<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<title>NudgeLearn+ å®Œå…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:"Segoe UI",sans-serif;background:linear-gradient(180deg,#eaf6ff,#ffffff);margin:0;padding:20px;color:#0b2545}
  h1{color:#1a73e8;margin:0}
  .subtitle{color:#35517a;margin-bottom:12px}
  .container{max-width:980px;margin:0 auto;display:grid;grid-template-columns:1fr 380px;gap:20px}
  .card{background:#fff;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(15,40,80,0.06)}
  .option{display:inline-block;padding:8px 12px;border-radius:10px;border:1px solid #cddff3;margin:6px;cursor:pointer}
  .option.selected{background:#e8f4ff;border-color:#1a73e8}
  button{background:#1a73e8;color:#fff;border:none;padding:10px 12px;border-radius:10px;cursor:pointer}
  button.ghost{background:#fff;color:#1a73e8;border:1px solid #d6e8ff}
  .stats{display:flex;justify-content:space-between;gap:8px}
  .stat{flex:1;background:#f6fbff;padding:10px;border-radius:8px;text-align:center}
  .leaderboard li{margin:6px 0}
  .mission{background:#fef9ec;border:1px solid #ffefc0;padding:10px;border-radius:8px}
  .message{background:#eefaf1;border:1px solid #dff4e9;padding:10px;border-radius:8px;margin-top:8px}
  input[type=text]{padding:8px;border-radius:8px;border:1px solid #cddff3;width:100%}
  .flex{display:flex;gap:8px}
  @media(max-width:900px){ .container{grid-template-columns:1fr; } }
</style>
</head>
<body>
<h1>ğŸ“˜ NudgeLearnï¼‹ï¼ˆå®Œå…¨ç‰ˆï¼‰</h1>
<p class="subtitle">è¡Œå‹•çµŒæ¸ˆå­¦ Ã— AI Ã— å…±é€šãƒ†ã‚¹ãƒˆå¯¾ç­– â€” ç¶šã‘ãŸããªã‚‹å­¦ã³ã‚’ãƒ‡ã‚¶ã‚¤ãƒ³</p>

<div class="container">
  <!-- å·¦ã‚«ãƒ©ãƒ  -->
  <div>
    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å -->
    <div class="card" id="userCard">
      <div class="flex">
        <input type="text" id="playerName" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" style="flex:1">
        <button onclick="saveName()">ä¿å­˜</button>
      </div>
      <small>â€»åå‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚</small>
    </div>

    <!-- AIãŠã™ã™ã‚ -->
    <div class="card">
      <h3>AIãŠã™ã™ã‚ï¼ˆå¼±ç‚¹å„ªå…ˆï¼‰</h3>
      <div id="aiSuggestion" style="font-weight:700;color:#1a73e8;margin-bottom:8px"></div>
      <div id="subjects"></div>
      <p id="subjectText"><small>é¸æŠä¸­ã®æ•™ç§‘ï¼š<b>æœªé¸æŠ</b></small></p>
      <div class="flex" style="margin-top:8px">
        <button onclick="startLearning()">ä»Šæ—¥ã‚‚å­¦ç¿’ï¼</button>
        <button class="ghost" onclick="startReview()">å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰</button>
      </div>
    </div>

    <!-- ãƒŸãƒƒã‚·ãƒ§ãƒ³ -->
    <div class="card">
      <h3>ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³</h3>
      <div id="missionBox" class="mission"></div>
      <div id="systemMessage" class="message" style="display:none"></div>
    </div>

    <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
    <div class="card">
      <h3>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
      <div class="stats">
        <div class="stat"><div>è§£ç­”æ•°</div><div id="totalSolved">0</div></div>
        <div class="stat"><div>XP</div><div id="xp">0</div></div>
        <div class="stat"><div>Lv.</div><div id="level">1</div></div>
      </div>
      <p style="margin-top:8px">é€£ç¶šå­¦ç¿’ï¼š<b id="streak">0</b>æ—¥ ï¼ ç§°å·ï¼š<b id="badge">åˆå¿ƒè€…</b></p>
      <div style="margin-top:8px">
        <button onclick="showDashboard()">æ›´æ–°</button>
      </div>
    </div>

    <!-- åˆæœŸåŒ– -->
    <div class="card">
      <h3>è¨­å®šãƒ»åˆæœŸåŒ–</h3>
      <p><small>ã€Œå­¦ç¿’è¨˜éŒ²ã®ã¿åˆæœŸåŒ–ã€ã§1æ—¥ç›®ã‹ã‚‰å†ã‚¹ã‚¿ãƒ¼ãƒˆã§ãã¾ã™ã€‚</small></p>
      <div class="flex" style="margin-bottom:8px">
        <button onclick="resetLearningData()">å­¦ç¿’è¨˜éŒ²ã‚’åˆæœŸåŒ–ï¼ˆ1æ—¥ç›®ã«æˆ»ã™ï¼‰</button>
      </div>
      <hr>
      <p><small>å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™å ´åˆã¯ã“ã¡ã‚‰</small></p>
      <div class="flex">
        <button class="ghost" onclick="confirmReset()">ã‚¢ãƒ—ãƒªå…¨ä½“ã‚’åˆæœŸåŒ–</button>
        <button class="ghost" onclick="exportData()">ãƒ‡ãƒ¼ã‚¿ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- å³ã‚«ãƒ©ãƒ  -->
  <div>
    <div class="card">
      <h3>ç§‘ç›®åˆ¥æˆç¸¾</h3>
      <div id="subjectStats"></div>
    </div>
    <div class="card">
      <h3>ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰</h3>
      <ol id="leaderboard"></ol>
    </div>
  </div>
</div>

<script>
const SUBJECTS=["å›½èª","æ•°å­¦","è‹±èª","ç†ç§‘","ç¤¾ä¼š"];
let selectedSubject="",playerName=localStorage.getItem("playerName")||"",streak=parseInt(localStorage.getItem("streak")||0),totalSolved=parseInt(localStorage.getItem("totalSolved")||0),xp=parseInt(localStorage.getItem("xp")||0),level=parseInt(localStorage.getItem("level")||1);

document.getElementById("playerName").value=playerName;

function saveName(){playerName=document.getElementById("playerName").value.trim()||"åç„¡ã—";localStorage.setItem("playerName",playerName);showMessage("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");updateLeaderboardRecord();}

/* AIãŠã™ã™ã‚ */
function getStats(sub){const d=JSON.parse(localStorage.getItem("stats_"+sub))||{solved:0,correct:0};const r=d.solved?d.correct/d.solved:0;return{solved:d.solved,correct:d.correct,rate:r};}
function suggest(){const arr=SUBJECTS.map(s=>{const st=getStats(s);const w=(1-st.rate)*0.7+(1/(st.solved+1))*0.3;return{name:s,weight:w,rate:st.rate,solved:st.solved};}).sort((a,b)=>b.weight-a.weight);
document.getElementById("aiSuggestion").textContent=`ğŸ‘‰ ä»Šæ—¥ã®ãŠã™ã™ã‚ã¯ã€Œ${arr[0].name}ã€ã§ã™`;
const cont=document.getElementById("subjects");cont.innerHTML="";arr.forEach(it=>{const d=document.createElement("div");d.className="option";d.textContent=`${it.name}ï¼ˆ${Math.round(it.rate*100)}% / ${it.solved}å•ï¼‰`;d.onclick=()=>selectSubject(d,it.name);cont.appendChild(d);});}

/* ç§‘ç›®é¸æŠ */
function selectSubject(el,sub){document.querySelectorAll(".option").forEach(o=>o.classList.remove("selected"));el.classList.add("selected");selectedSubject=sub;document.getElementById("subjectText").innerHTML=`é¸æŠä¸­ã®æ•™ç§‘ï¼š<b>${sub}</b>`;}

/* å­¦ç¿’é–‹å§‹ */
function startLearning(){if(!selectedSubject)return alert("æ•™ç§‘ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");streak++;localStorage.setItem("streak",streak);updateBadge();window.open(`study.html?subject=${encodeURIComponent(selectedSubject)}&mode=normal`,"_blank");}
function startReview(){if(!selectedSubject)return alert("æ•™ç§‘ã‚’é¸ã‚“ã§ãã ã•ã„ï¼");window.open(`study.html?subject=${encodeURIComponent(selectedSubject)}&mode=review`,"_blank");}

/* ãƒãƒƒã‚¸ãƒ»XP */
function updateBadge(){const b=streak<3?"åˆå¿ƒè€…":streak<7?"ç¶™ç¶šå­¦ç¿’è€…":streak<14?"ä¸Šç´šç¶™ç¶šè€…":"åŠªåŠ›ç‹ğŸ”¥";document.getElementById("badge").textContent=b;}
function addXP(n){xp=parseInt(localStorage.getItem("xp")||0)+n;localStorage.setItem("xp",xp);level=Math.floor(xp/100)+1;localStorage.setItem("level",level);showDashboard();}

/* ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ */
function showDashboard(){totalSolved=parseInt(localStorage.getItem("totalSolved")||0);xp=parseInt(localStorage.getItem("xp")||0);level=parseInt(localStorage.getItem("level")||1);streak=parseInt(localStorage.getItem("streak")||0);
document.getElementById("totalSolved").textContent=totalSolved;document.getElementById("xp").textContent=xp;document.getElementById("level").textContent=level;document.getElementById("streak").textContent=streak;updateBadge();renderSubjectStats();renderLeaderboard();}

/* ç§‘ç›®åˆ¥çµ±è¨ˆ */
function renderSubjectStats(){const c=document.getElementById("subjectStats");c.innerHTML="";SUBJECTS.forEach(s=>{const st=getStats(s);c.innerHTML+=`<div>${s}ï¼š${Math.round(st.rate*100)}%ï¼ˆ${st.solved}å•ï¼‰</div>`;});}

/* ãƒªãƒ¼ãƒ€ãƒ¼ãƒœãƒ¼ãƒ‰ */
function updateLeaderboardRecord(){const n=localStorage.getItem("playerName")||"åç„¡ã—";const lb=JSON.parse(localStorage.getItem("leaderboard")||"[]");const idx=lb.findIndex(i=>i.name===n);const t=parseInt(localStorage.getItem("totalSolved")||0);if(idx>=0)lb[idx].score=t;else lb.push({name:n,score:t});lb.sort((a,b)=>b.score-a.score);localStorage.setItem("leaderboard",JSON.stringify(lb));}
function renderLeaderboard(){const lb=JSON.parse(localStorage.getItem("leaderboard")||"[]");document.getElementById("leaderboard").innerHTML=lb.slice(0,10).map(i=>`<li>${i.name} â€” ${i.score}å•</li>`).join("");}

/* å­¦ç¿’è¨˜éŒ²ã®ã¿åˆæœŸåŒ– */
function resetLearningData(){if(!confirm("å­¦ç¿’è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦1æ—¥ç›®ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ"))return;localStorage.setItem("streak",0);localStorage.setItem("xp",0);localStorage.setItem("level",1);localStorage.setItem("totalSolved",0);for(const s of SUBJECTS){localStorage.removeItem("stats_"+s);localStorage.removeItem("wrong_"+s);}streak=xp=totalSolved=0;level=1;updateBadge();showDashboard();suggest();showMessage("âœ… å­¦ç¿’è¨˜éŒ²ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚ä»Šæ—¥ãŒæ–°ã—ã„1æ—¥ç›®ã§ã™ï¼");}

/* å…¨ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ– */
function confirmReset(){if(!confirm("ã‚¢ãƒ—ãƒªå…¨ä½“ã‚’åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ"))return;localStorage.clear();location.reload();}

/* ä¾¿åˆ©ç³» */
function showMessage(msg){const el=document.getElementById("systemMessage");el.style.display="block";el.textContent=msg;setTimeout(()=>el.style.display="none",4000);}
function exportData(){const data=JSON.stringify(localStorage);const blob=new Blob([data],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="nudgelearn_data.json";a.click();URL.revokeObjectURL(url);showMessage("ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚");}

/* åˆæœŸåŒ– */
suggest();showDashboard();updateLeaderboardRecord();renderLeaderboard();
</script>
</body>
</html>
